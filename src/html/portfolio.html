<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>
<body>
<nav class="navbar navbar-expand-lg bg-dark" data-bs-theme="dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="/index">SportMarket</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/index">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/portfolio">Portfolio</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/profile">Profile</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/login">Login/Register</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logout">Logout</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<h1>Enter User ID</h1>
<ul>
  <h6> Examples </h6>
  <li>06e8b6ab-9f5a-11ed-84ee-8cc681d9188f</li>
</ul>

<form id="myForm">
  <label for="userid">User ID:</label>
  <input type="text" id="userid" name="userid"><br><br>
  <input type="button" value="Submit" onclick="submitGetUserInfos()">
</form>
<div id="response"></div>

<table class="table" id="myTable">
  <thead>
  <tr>
    <th scope="col">Team</th>
    <th scope="col">Shares Owned</th>
    <th scope="col">Price</th>
    <th scope="col">Total</th>
  </tr>
  </thead>
  <tbody id="tableBody">
  </tbody>
</table>

<script>
  let user_portfolio = new Map();
  function submitGetUserInfos() {
    // Get the form data
    const form = document.getElementById("myForm");
    const formData = new FormData(form);

    const baseUrl = 'https://z340b62ka1.execute-api.us-east-2.amazonaws.com/get_user_portfolio';
    const queryParams = {
      user_id: formData.get("userid")
    };

    const queryString = new URLSearchParams(queryParams).toString();
    const url = `${baseUrl}?${queryString}`;

    // Send the POST request
    fetch(url, {
      method: 'GET',
    }).then(response => response.text())
            .then(data => {
              console.log(JSON.parse(data))
              //document.getElementById("response").innerHTML = data;
              user_portfolio = new Map(Object.entries(JSON.parse(data)));
              generateTable()

            });
  }

  async function generateTable() {

    const price_data = await getPrices();
    console.log(price_data)
    var data = user_portfolio;

    // Get the table body element
    var tableBody = document.getElementById("tableBody");
    tableBody.innerHTML = "";

    data.forEach(function(value, key) {
      var row = tableBody.insertRow();
      var cell1 = row.insertCell(0);
      var cell2 = row.insertCell(1);
      var cell3 = row.insertCell(2);
      var cell4 = row.insertCell(3);
      cell1.innerHTML = key;
      cell2.innerHTML = value;
      cell3.innerHTML = price_data[key];
      cell4.innerHTML = (parseFloat(price_data[key]) * parseFloat(value)).toString();
    });
  }

</script>

<script src="../js/functions.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

</body>
</html>